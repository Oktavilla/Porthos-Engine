<% if datum.asset %>
<div class="image">
  <%= image_tag datum.asset.version_url(:size => 'c80x80') %>
  <% if datum.title.present? %>
    <div class="title"><%= datum.title %></div>
  <% end %>
  <% if datum.description.present? %>
    <div class="caption"><%= datum.description %></div>
  <% end %>
  <div class="add">
  <%= link_to t('.edit_asset'), edit_admin_asset_path(datum.asset, :return_to => admin_page_path(@page, :anchor => "datum_#{datum.id}")), :class => 'new' %>
  <%= link_to t('.change_image'), admin_assets_path({
    :by_type => 'ImageAsset',
    :create_callback => {
      :path => admin_page_datum_path(@page, datum._parent_document, :parent_id => (datum._parent_document._parent_document if !datum._parent_document.is_a?(Page) && datum._parent_document._parent_document != datum._root_document)),
      :method => 'put',
      :asset_field_name => CGI::escape('datum[data_attributes][0][asset_id]'),
      :params => { CGI::escape('datum[data_attributes][0][id]') => datum.id }
    }}), :class => 'new' %>
  </div>
</div>
<% else %>
  <% if datum.instruction_body %>
    <p class="instructions"><%= datum.instruction_body %></span>
  <% end %>
  <% unless datum._parent_document.is_a?(FieldSet) %>
    <div class="add">
      <%= link_to t('.choose_image'), admin_assets_path(:by_type => 'ImageAsset', :create_callback => { :path => admin_page_datum_path(@page, datum, :parent_id => (datum._parent_document unless datum._parent_document.is_a?(Page))), :method => 'put', :asset_field_name => 'datum[asset_id]' }), :class => 'new' %>
    </div>
  <% else %>
    <div class="add">
    <%= link_to t('.choose_image'), admin_assets_path({
      :by_type => 'ImageAsset',
      :create_callback => {
        :path => admin_page_datum_path(@page, datum._parent_document, :parent_id => (datum._parent_document._parent_document  if !datum._parent_document.is_a?(Page) && datum._parent_document._parent_document != datum._root_document)),
        :method => 'put',
        :asset_field_name => CGI::escape('datum[data_attributes][0][asset_id]'),
        :params => { CGI::escape('datum[data_attributes][0][id]') => datum.id }
      }}), :class => 'new' %>
    </div>
  <% end %>
<% end %>