<% @page_title = 'Sidor' -%>
<% @page_class = 'layout3' -%>
<%= render :partial => 'admin/pages/sub_nav' %>
<div id="workspace">
  <div class="header">
    <% if @page_template %>
    <h1><%= @page_template.label %></h1>
    <% else %>
    <h1><%= t('.all_pages') %></h1>
    <% end %>
  </div>
  <div class="tools">
    <% if @page_template %>
    <div class="add">
      <%= link_to t('.create_new', :template => @page_template.label.downcase), new_admin_page_path(:page_template_id => @page_template.id), :class => 'new' %>
    </div>
    <% end %>
    <%= form_tag admin_pages_path, :method => :get do |f| %>
    <div class="sort">
      <label for="filters_order_by">Sortering:</label>
      <% current_scopes.except(:order_by).each do |filter, value| -%>
        <%= hidden_field_tag filter, value %>
      <% end -%>
        <%= select_tag 'order_by', options_for_select({ 'Senast Ã¤ndrad' => 'updated_at desc', 'Publicerad' => 'published_on desc', 'A-Z' => 'title asc' }, current_scopes[:order_by]) %>
    </div>
    <% end %>
  </div>
  <div id="content">
    <div class="tablewrap">
      <table id="pages">
        <thead>
          <tr>
            <th><%= Page.human_attribute_name(:title) %></th>
            <th><%= t(:updated_at) %></th>
            <th><%= t(:status) %></th>
          </tr>
        </thead>
        <tbody>
      <% @pages.each do |page| %>
        <tr>
          <td class="content">
            <%= render :partial => page.template.views.admin_in_list, :locals => { :page => page } %>
            <% unless page.full_uri.blank? -%>
              <% page_path(:field_set_id => page.field_set_id, :id => page.uri) %>
            <% end -%>
            <% if page.tags.any? -%>
            <div class="tags"><%= page.tags.collect { |tag| link_to(tag.name, admin_pages_path(:tags => [tag.name]))}.join(', ').html_safe %></div>
            <% end -%>
          </td>
          <td class="updated_at">
            <% if page.updated_at && page.updated_at != page.created_at -%>
            <%= page.updated_at.strftime("%d %b") %>
              <% if page.updated_by.present? %>
               <%= t(:by) %> <%= page.updated_by.first_name %>
              <% end %>
            <% end -%>
          </td>
          <td class="status">
            <% if page.published? %>
            <span class="status published"><%= t(:published) %></span>
            <% else %>
            <span class="status unpublished"><%= t(:unpublished) %></span>
            <% end %>
          </td>
        </tr>
      <% end %>
      </table>
    </div>
    <%= paginate @pages if @pages.any? %>
  </div>
</div>
